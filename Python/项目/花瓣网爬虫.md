## preface

æœ¬æ–‡ï¼Œæ˜¯å…³äº python çˆ¬è™«æ–¹å‘çš„çŸ¥è¯†æ•´ç†ã€‚

çˆ¬å–ç½‘ç«™ï¼š https://huaban.com/favorite/beauty

å‚è€ƒæ•™ç¨‹ï¼š
- [Python GUIä¹‹tkinterçª—å£è§†çª—æ•™ç¨‹](https://www.cnblogs.com/shwee/p/9427975.html)
- [TkDocs](https://tkdocs.com/tutorial/index.html)
- [tkinter åŸºç¡€æ•™ç¨‹](https://www.cnblogs.com/hoyun/p/15137561.html)
- [tkinter å¤šçº¿ç¨‹å¡æ­»](https://www.cnblogs.com/anita-harbour/p/9336924.html)


ä¸€ã€è¿‡ç¨‹
----------------


### 1.1 ç¬¬ä¸€ä¸ªé—®é¢˜

>å…³äºçˆ¬åˆ°çš„htmlä¸f12å¾—åˆ°çš„æœ‰åŒºåˆ«ï¼Œæ‰€ä»¥reå†™`pattern`ä¸èƒ½å‡­ç€F12
>**ç›®æ ‡**ï¼šæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„`pattern`ä¾¿äºæ‰¾åˆ°url

>æ‰€è°“æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œå°±æ˜¯åˆ«äººæœåŠ¡å™¨å‘é€åˆ°æµè§ˆå™¨çš„åŸå°ä¸åŠ¨çš„ä»£ç ã€‚è¿™æ˜¯çˆ¬è™«è·å¾—çš„ä»£ç 
ä½ é‚£äº›åœ¨æºç ä¸­æ‰¾ä¸åˆ°çš„ä»£ç ï¼ˆå…ƒç´ ï¼‰ï¼Œé‚£æ˜¯åœ¨æµè§ˆå™¨æ‰§è¡ŒjsåŠ¨æ€ç”Ÿæˆçš„ï¼Œè¿™äº›èƒ½åœ¨å®¡æŸ¥å…ƒç´ ä¸­çœ‹åˆ°
é€šè¿‡å®¡æŸ¥å…ƒç´ å°±ï¼Œçœ‹åˆ°å°±æ˜¯æµè§ˆå™¨å¤„ç†è¿‡çš„æœ€ç»ˆçš„htmlä»£ç ã€‚

ç„¶åè¯•äº†è¯•æ›´æ¢å¤´ä¿¡æ¯ï¼Œ

<img src="https://img-blog.csdnimg.cn/20200801215657860.png" style="zoom:60%">

>å°±ç¦»è°±ï¼Œrequests.getè¿‡æ¥çš„åŸºæœ¬æ²¡æ‰¾åˆ°`<div>`æ ‡ç­¾ï¼ŒF12æ£€æŸ¥å…ƒç´ å…¨æ˜¯`<div>`æ ‡ç­¾
>æ„Ÿè§‰ï¼šçˆ¬åˆ°çš„å’ŒF12åˆ°çš„æ˜¯ä¸¤ä¸ªä¸œè¥¿

### 1.2 ç¬¬äºŒä¸ªé—®é¢˜

>ä»å¾—åˆ°çš„textä¸­æ‰¾å‡ºå›¾ç‰‡çš„åœ°å€

å…ˆç”¨ http://www.bejson.com/ è¿›è¡Œtextåˆ†æï¼Œå‘ç°å›¾ç‰‡çš„åœ°å€ä¸º
`https://hbimg.huabanimg.com/`+`key`

### 1.3 ç¬¬ä¸‰ä¸ªé—®é¢˜

>å…³äºå¾—åˆ°æ•°æ®çš„ä¸å®Œæ•´æ€§ï¼Œ
>**ç›®æ ‡**ï¼šæ‰¾å‡º`url_next`

çˆ¬åˆ°çš„ä¸œè¥¿åªæœ‰å‰é¢ä¸€äº›å›¾ç‰‡ï¼Œç»æŸ¥è¯¢å¥½åƒæ˜¯ä¸€ç§å…³äº**åŠ¨æ€ç½‘é¡µå¼‚æ­¥æ›´æ–°**çš„æŠ€æœ¯
å‚è€ƒï¼š https://zhuanlan.zhihu.com/p/27346009
(å½“ç„¶ç½‘ç«™è¡¨é¢æ²¡æœ‰é¡µï¼Œè¡¨é¢çš„urlä¹Ÿæ²¡æœ‰å˜ï¼‰

![](https://img-blog.csdnimg.cn/2020080121565813.png)

ç»æŸ¥è¯¢ï¼Œå‘ä¸‹ç¿»é¡µæ—¶XHRä¼šå¤šå‡ºè¯·æ±‚ï¼Œurlåœ°å€å·²ç»™å‡º
æ˜¯æ—¶å€™æ›´æ”¹1.0ç‰ˆæœ¬çš„ä»£ç ï¼Œè®©å®ƒæ‰¾åˆ°æ›´å¤šçš„å›¾ç‰‡ğŸˆï¼ˆè‡ªåŠ¨åŠ è½½æ–°é¡µï¼‰

ç»è¿‡ç¬¬ä¸€ä¸ªé—®é¢˜çš„æŠ˜ç£¨ï¼Œå®¹æ˜“ç†è§£ï¼š
- è™½ç„¶ï¼ˆç¿»é¡µåçš„ï¼‰urlï¼Œç”¨æµè§ˆå™¨æ— æ³•è®¿é—®ï¼Œä½†getå¯ä»¥çˆ¬åˆ°


äºŒã€åŸºç¡€çŸ¥è¯†
------------------

### 2.1 å…³äºrequests

##### å¼€å§‹ä½¿ç”¨ç¬¬ä¸€æ­¥ï¼š
```python
  import requests
  r=requests.get("http://")
  r.status_code                     #en,è¿”å›200è¡¨ç¤ºæˆåŠŸ
```

##### å¼€å§‹ä½¿ç”¨ç¬¬äºŒæ­¥ï¼š
```python
  r.encoding = 'utf-8'
  r.text                            #en,è¿”å›ç½‘ç«™çš„html
```

##### å…¶å®ƒï¼š
`r.apparent_encoding`  ã€ä»å†…å®¹åˆ†æå‡ºå“åº”å†…å®¹ç¼–ç æ–¹å¼ï¼Œè¿”å›ä¸€ä¸ªç¼–ç æ–¹å¼å­—ç¬¦ä¸²ã€‘
`r.raise_for_status`   ã€å¦‚æœä¸æ˜¯200ï¼Œè¿”å›å¼‚å¸¸ç ã€‘

>ä¸ƒä¸ªä¸»è¦æ–¹æ³•ï¼š
>- `requests.request(method,url,**kwargs)`
>- `requests.get(url,**kwargs)`, headersä¸­ä¼ªè£…å¤´ä¿¡æ¯
>- requests.post()
>- requests.put()
>- requests.patch()
>- requests.head()
>- requests.delete()


### 2.2 å…³äºre
https://www.unielu.com/posts/10df.html

### 2.3 å…³äºé¢å‘å¯¹è±¡

`if __name__ == '__main__'`
è¡¨ç¤ºï¼šåªæœ‰å½“è¯¥æ–‡ä»¶ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„è„šæœ¬è¿è¡Œæ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚
æ¢å¥è¯è¯´ï¼Œå¦‚æœåœ¨å…¶å®ƒæ–‡ä»¶ä¸­å¯¼å…¥æ­¤æ–‡ä»¶ï¼Œé‚£ä¹ˆæ¡ä»¶ä¸­çš„è¯­å¥ä¸è¢«æ‰§è¡Œã€‚


ä¸‰ã€ä»£ç å®ç°
-----------------

### 1.0ç‰ˆæœ¬ï¼š

```python
import re
import requests
import os

pwd="C:/temp/temp"
url = "https://huaban.com/favorite/beauty/" #è¿™æ˜¯ä½ è¦çˆ¬å–çš„é¡µé¢url
url_img = "https://hbimg.huabanimg.com/" #è¿™æ˜¯å®ƒæ”¾å›¾ç‰‡çš„urlå‰ç¼€
num=0

#ä¼ªè£…å¤´ä¿¡æ¯
head = {'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36 Edg/84.0.522.49'}

def download(file,url):
    print("å¼€å§‹ä¸‹è½½ï¼š",file,url)
    try:
        r = requests.get(url,stream=True)
        with open(file, 'wb') as fd:
            for chunk in r.iter_content():
                fd.write(chunk)
    except Exception as e:
        print("ä¸‹è½½å¤±è´¥äº†",e)
    
def main(url):
    global num
    print("*******************************************")
    print("ä½ çš„è¯·æ±‚ç½‘å€æ˜¯ï¼š",url)
    
    r=requests.get(url,headers=head)
    pattern=re.compile('{"pin_id":(\d*?),.*?"key":"(.*?)",.*?"like_count":(\d*?),.*?"repin_count":(\d*?),.*?}',re.S)
    pid=0
    items=re.findall(pattern,r.text)
    
    for item in items:
        pid,key,like_cnt,repin_cnt=item
        print("å¼€å§‹ä¸‹è½½ç¬¬{}å¼ å›¾ç‰‡".format(num))
        
        pic_url=url_img+key    #å›¾ç‰‡çš„urlåœ°å€
        filename=pwd+str(pid)+".jpg"  #æ–‡ä»¶ä¿å­˜çš„åå­—
        
        if os.path.isfile(filename):
            print("æ–‡ä»¶å­˜åœ¨ï¼š",filename)
            continue
        
        download(filename,pic_url)
        num+=1

if not os.path.exists(pwd):
    os.makedirs(pwd)
main(url)
```

### 1.1ç‰ˆæœ¬

```python
import re
import requests
import os

pwd="C:/temp/temp"
url = "http://huaban.com/favorite/beauty/"
url_img = "https://hbimg.huabanimg.com/"
url_next="https://huaban.com/favorite/beauty?kdbpp4xg&max="
num=0

#ä¼ªè£…å¤´ä¿¡æ¯
head = {'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36 Edg/84.0.522.49'}

def download(file,url):
    print("å¼€å§‹ä¸‹è½½ï¼š",file,url)
    try:
        r = requests.get(url,stream=True)
        with open(file, 'wb') as fd:
            for chunk in r.iter_content():
                fd.write(chunk)
    except Exception as e:
        print("ä¸‹è½½å¤±è´¥äº†",e)
    
def main(url):
    global num
    print("*******************************************")
    print("ä½ çš„è¯·æ±‚ç½‘å€æ˜¯ï¼š",url)
    
    r=requests.get(url,headers=head)
    pattern=re.compile('{"pin_id":(\d*?),.*?"key":"(.*?)",.*?"like_count":(\d*?),.*?"repin_count":(\d*?),.*?}',re.S)
    pid=0
    items=re.findall(pattern,r.text)
    
    for item in items:
        pid,key,like_cnt,repin_cnt=item
        print("å¼€å§‹ä¸‹è½½ç¬¬{}å¼ å›¾ç‰‡".format(num))
        
        pic_url=url_img+key    #å›¾ç‰‡çš„urlåœ°å€
        filename=pwd+str(pid)+".jpg"  #æ–‡ä»¶ä¿å­˜çš„åå­—
        
        if os.path.isfile(filename):
            print("æ–‡ä»¶å­˜åœ¨ï¼š",filename)
            continue
        
        download(filename,pic_url)
        num+=1
    main(url_next+pid+"&limit=100&wfl=1")    #æ¯”1.0å¤šå‡ºçš„åœ°æ–¹ï¼Œå‚è€ƒé—®é¢˜3

if not os.path.exists(pwd):
    os.makedirs(pwd)
main(url)

```

### 2.0 ç‰ˆæœ¬

`2021-08-13` æ›´æ–°ï¼š
1ã€ä½¿ç”¨ç±»å¯¹çˆ¬è™«éƒ¨åˆ†è¿›è¡Œé‡å†™
2ã€å¯ä»¥è®¾ç½®è·¯å¾„ã€æ•°ç›®
3ã€åŠ å…¥å›¾å½¢åŒ–ç•Œé¢

```python
import re
import requests
import os
import tkinter as tk
import tkinter.messagebox 
import time

class pc:
    def __init__(self, pwd = "C:/temp/", num = 66):
        self.pwd = pwd
        self.num = num
        self.cnt = 0

        self.url_img = "https://hbimg.huabanimg.com/"
        self.url_next="https://huaban.com/favorite/beauty?kdbpp4xg&max="

        #ä¼ªè£…å¤´ä¿¡æ¯
        self.head = {'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36 Edg/84.0.522.49'}

        if not os.path.exists(pwd):
            os.makedirs(pwd)

    def download(self, file, url):
        self.cnt += 1
        print("\n==============================================")
        print("å¼€å§‹ä¸‹è½½ç¬¬{}å¼ å›¾ç‰‡".format(self.cnt))
        print("ä¸‹è½½å›¾ç‰‡ï¼š{}".format(url))
        print("ä¿å­˜ä¸ºï¼š{}".format(file))

        try:
            r = requests.get(url,stream=True)
            with open(file, 'wb') as fd:
                for chunk in r.iter_content():
                    fd.write(chunk)
        except Exception as e:
            print("ä¸‹è½½å¤±è´¥äº†",e)

    def main(self, url):
        print("**********************************************")
        print("ä½ çš„è¯·æ±‚ç½‘å€æ˜¯ï¼š",url)

        r = requests.get(url, headers = self.head)
        pattern = re.compile('{"pin_id":(\d*?),.*?"key":"(.*?)",.*?"like_count":(\d*?),.*?"repin_count":(\d*?),.*?}', re.S)
        items = re.findall(pattern, r.text)

        for item in items:
            pid, key, like_cnt, repin_cnt = item

            pic_url = self.url_img + key             #å›¾ç‰‡çš„urlåœ°å€
            filename = self.pwd + str(pid) + ".jpg"  #æ–‡ä»¶ä¿å­˜çš„åå­—

            if os.path.isfile(filename):
                print("æ–‡ä»¶å­˜åœ¨ï¼š",filename)
                continue

            self.download(filename, pic_url)

            if self.cnt == self.num:
                print("ä¸‹è½½å®Œæˆ")
                return

        self.main(self.url_next + pid + "&limit=100&wfl=1")    #é¡µé¢åŠ è½½


if __name__ == "__main__":
    url = "http://huaban.com/favorite/beauty/"

    def begin():
        t1 = time.time()
        entry_pwd = pwd.get()
        entry_num = int(num.get())
        p = pc(entry_pwd,entry_num)
        p.main(url)
        t2 = time.time()
        tk.messagebox.showinfo(title='æç¤º', message='ä¸‹è½½å®Œæˆï¼Œè€—æ—¶{:.2f}s'.format(t2-t1))  

    window = tk.Tk()
    window.title("èŠ±ç“£ç½‘çˆ¬è™«å·¥å…·V2.0")
    window.geometry("500x309")

    tk.Label(text="æ¬¢è¿ä½¿ç”¨è¯¥çˆ¬è™«å·¥å…·ã€‚â­", font=('Arial', 14)).place(x=150, y=20)

    tk.Label(window, text = "å›¾ç‰‡åœ°å€ï¼šhttps://hbimg.huabanimg.com/", font=('Arial', 14)).place(x=70,y=80)
    tk.Label(window, text = "ä¿å­˜è·¯å¾„ï¼š", font=('Arial', 14)).place(x=70,y=120)
    tk.Label(window, text = "ä¸‹è½½æ•°ç›®ï¼š", font=('Arial', 14)).place(x=70,y=160)

    pwd = tk.StringVar()
    pwd.set("c:/temp/")
    tk.Entry(window, textvariable=pwd, font=('Arial', 14)).place(x=170,y=120)

    num = tk.StringVar()
    num.set("5")
    tk.Entry(window, textvariable=num, font=('Arial', 14)).place(x=170,y=160)

    tk.Button(window, text="å¼€å§‹ä¸‹è½½", font=('Arial', 14), command = begin).place(x=200,y=210)

    tk.Label(window,text="è¯´æ˜ï¼šç‚¹å‡»å¼€å§‹ä¸‹è½½åä¼šå‡ºç°å¡é¡¿ï¼Œå…¨éƒ¨ä¸‹è½½å®Œæˆåæ‰ä¼šå¼¹çª—ã€‚").pack(side="bottom")
    tk.Label(window,text="Designed by å°†å¿ƒæ™´").pack(side="bottom")

    window.mainloop()
```

å››ã€å°ç»“
------------------

`2020.8.1`
 å•¦å•¦å•¦ï¼Œ `1.1`ç‰ˆæœ¬æˆåŠŸï¼Œæ¿€åŠ¨ing
ä»Šå¤©è¿˜è¯•äº†è¯• beautifulsoup ï¼Œfiddler ï¼Œæ²¡é¢†æ‚Ÿ~

--------------------

`2021.8.13`

å†™äº† V2.0 ç‰ˆæœ¬

<img src="https://img-1301102143.cos.ap-beijing.myqcloud.com/202112041113580.png">

æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ `.exe` æ–‡ä»¶ä¹‹å 11.9mb