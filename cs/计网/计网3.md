考纲内容：
- 数据链路层的功能
- 组帧
- 差错控制
   - 检错编码；纠错编码 
- 流量控制与可靠传输机制
  - 流量控制、可靠传输与滑动窗口机制；停止-等待协议
  - 后退 N 帧协议（GBN）；选择重传协议（SR）
- 介质访问控制
  - 信道划分
    - 频分多路复用、时分多路复用、波分多路复用、码分多路复用的概念和基本原理
  - 随机访问
    - ALOHA CSMA CSMA/CD CSMA/CA
  - 令牌传递协议
- 局域网
  - 局域网的基本概念与体系结构；以太网与 IEEE 802.3
  - IEEE 802.11 无线局域网；VLAN 基本概念与基本原理
- 广域网
  - 广域网的基本概念；PPP 协议
- 数据链路层设备
  - 局域网交换机及其工作原理



----------------------

数据链路层主要功能：
- 为网络层提供服务
- 链路管理，即建立、维护、拆除数据链路（用于面向连接的服务）
- 组帧，同步
- 差错控制（帧错、位错）
- 流量控制
- 透明传输
- 寻址（多点链路）


-----------------------

数据链路层向网络层提供的服务：
- 面向连接确认服务
- 无连接确认服务
- 无连接不确认服务



## 3.1 术语说明

**结点**：主机、路由器

**链路**：网络两个结点之间的物理通道，如双绞线、微波等

**数据链路**：数据链路层实体的连接叫数据链路。多个数据链路复用一条物理连接。（from学校）

**数据链路**：网络中两个结点之间的逻辑通道，即链路+邮件+软件封装成了数据链路。

**帧**：链路层的协议数据单元，封装网络层数据报。（数据链路层的分组）

**数据链路层**，负责从一个结点通过一条链路向另一个物理链路直接相邻结点传送数据报。

**主要作用**：加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。

-----------------

- **封装成帧** 就是在一段数据的前后部分添加首部和尾部，这样就构成了一个帧
- 组帧的方法：⭐
  - 字符计数法
  - 字符（节）填充法
  - 零比特填充法
  - 违规编码法



## 3.2 差错控制

概括来说，传输中的差错都是由于噪声引起的。

>由若干位代码组成的一个字叫 **码字**<br>
>将两个码字逐位进行对比，具有不同的位的个数称为 **两个码字间的距离**<br>
>一种编码方案可能有若干个合法码字，两个合法码字间的最小距离称为 **码距**

- 位错（比特位出错）
  - 检错编码
    - 奇偶校验码（添加一位奇偶校验位）
      - 奇校验码：整个校验码（有效信息位和校验位）中 1 的个数为奇数
      - 偶校验码：整个校验码（有效信息位和校验位）中 1 的个数为偶数
    - `循环冗余码CRC`⭐
  - 纠错编码
    - `海明码`⭐
      - 设计思路：将信息位分组进行偶校验 -> 多个校验位 -> 多个校验位标注出错位置
      - 信息位 n 位，校验位 k 位，需满足：$$2^k \ge n+k+1$$
      - 校验位 $P_i$ 放在海明位号为 $2^{i-1}$ 的位置上
- 帧错（丢失，重复，失序）


## 3.3 流量控制与可靠传输机制

数据链路层的流量控制是点对点的，而传输层的流量控制是端到端的。

- 流量控制（限制发送方的发送速率）
  - `停止-等待协议`
    - 每发送一个帧就停止发送，等待收到对方的确认帧
    - $信道利用率 = \frac{L(T内发送的比特数)/C(发送方数据传输率)}{T(发送周期)}$
  - `后退N帧协议` GBN
    - 累计确认
    - $1\le W_T \le 2^n-1$
  - `选择重传协议` SR
    - 逐一确认
    - $W_{Tmax} = W_{Rmax} = 2^{n-1}$
- 可靠传输（通常使用确认和超时重传两种机制来完成）

**丢包**：物理线路故障、设备故障、病毒攻击、路由信息错误等，会导致数据包的丢失。

**ACK**：即确认字符，通常ACK信号有自己固定的格式、长度大小，由接收方回复给发送方。

**RTS**（request to send）请求发送，**CTS**（clear to send）允许发送


## 3.4 介质访问控制

目的：使节点间的通信不会发生相互干扰的情况。

- 静态划分信道
  - **信道划分介质访问控制**
    - 频分多路复用`FDM`
      - 将多路基带信号调制到不同频率载波上。频带传输，模拟信道
    - 时分多路复用`TDM`
      - 将时间分成若干时间片，轮流分配给多个信号
    - 统计时分多路复用`STDM`
      - 按需动态地分配时隙，提高线路利用率
    - 波分多路复用`WDM`
      - 光的频分多路复用
    - 码分多路复用`CDM`
      - 既共享信道的频率，又共享时间
      - 码分多址 `CDMA`
        - 两个不同码片序列正交，即规格化内积为 0
        - 主要用于无线通信系统，特别是移动通信系统
- 动态分配信道
  - **轮询访问介质访问控制**
    - 令牌：一个特殊的MAC控制帧，它本身并不包含信息
    - 非常适合负载很高的广播信道
  - **随机访问介质访问控制**⭐【只有它会发生冲突】
    - ALOHA协议
      - 纯ALOHA协议，想发就发，超时后等一段随机事件重传
      - 时隙ALOHA协议，每个时隙开始时才能发送一个帧。吞吐量更高
    - CSMA协议
      - CS：载波监听，发送数据前检测总线上是否有其他发送数据（利用信号电压摆动值）
      - MA：多点接入，许多计算机以多点接入的方式连在一根总线上
      - 分类
        - 1-坚持，直接发，忙则坚持监听
        - 非坚持，直接发，忙则等待随机时间再监听
        - p-坚持，p概率发，忙则坚持监听
    - `CSMA/CD`协议
      - CD：碰撞检测，边发送边监听
      - 需要在帧的发送期间就能检测出碰撞，即：$\frac{最小帧长}{数据传输速率} \ge 2\tau$
      - $2\tau$(争用期)(冲突窗口)(碰撞窗口)，信号在最远的两个端点之间往返传输的时间
      - 二进制指数退避算法
    - `CSMA/CA`协议
      - 应用于无线局域网
      - 利用RTS和CTS解决隐蔽站问题
      - 帧间间隔IFS
        - SIFS，时间最短，分隔一次对话的各帧
        - PIFS
        - DIFS，时间最长，用于异步帧竞争访问的时延



## 3.5 局域网

**局域网**，local area network

- 指在某一区域内的多台计算机互联成的计算机组，共享介质的 **广播式** 分组交换网。
- 网络拓扑结构
  - 星型、环型、树型
  - 总线型（推荐）
- 特性：
  - 跨距小
  - 速度快
  - 误码率低，可靠性高
  - 广播信道，多点连接

-------------------

**介质访问**

- 局域网的中心问题是广播媒体的介质访问控制技术
- 分类
  - 静态分配：每个用户有自己的频段或时隙，不会冲突
  - 动态分配：信道在用户需要时，才进行分配
    - 随机接入：争用，ALOHA技术，CSMA/CD
    - 受控接入：预约，轮转


-------------------

## 3.6 HDLC协议

广域网有两种常用的链路层协议：`PPP` 协议和 `HDLC` 协议.

`HDLC` （high-level data link control）是一种面向比特的网络节点之间同步传输数据的数据链路层协议。

- 四个特点
  - 对于任何一种比特流都可透明传输
  - 较高的数据链路传输效率
  - 所有的帧都有帧校验序列FCS，传输可靠性高
  - 用同一的帧格式来实现传输
- 三种类型的站
  - 主站，主站发出的帧叫命令帧，负责对链路进行控制
  - 从站，从站发出的帧叫响应帧，在主站的控制下进行操作
  - 复合站
- 链路配置
  - 非平衡配置
  - 平衡配置
- 数据传输方式
  - 正常响应方式
  - 异步平衡方式
  - 异步响应方式
- 帧类型
  - 信息帧
  - 管理帧
  - 无编号帧

参考资料：https://blog.csdn.net/wangguchao/article/details/109595845

------------------

## 3.7 以太网

现在广泛使用的局域网只有以太网，

**以太网**（Ethernrt）是由Xerox公司创建的并由…联合开发的 **基带总线局域网规范** ，是当今现有局域网采用的最通用的通信协议标准。以太网使用 `CSMA/DA`（载波监听多路访问及冲突检测）技术。

- 以太网的服务 -> 不可靠交付，`无连接`，`不发确认`。
  - 因为：局域网信道的质量很好，发生差错概率很小
- CSMA/CD, Carrier Sense Multiple Access/Collision Detect
  - 多点接入：总线网络，多台计算机连接在一根总线上
  - 载波监听：每个站在发送数据前要先检测总线上是否有其它计算机发送数据，避免冲突
  - 碰撞检测：边发送边监听
  - 特点：先听先发，边听边发，冲突停止，延迟重发
- 使用 CSMA/CD 的以太网不能进行全双工通信，只能进行双向交替通信（半双工通信）

---------------------

MAC **媒体访问控制层**：控制传输及介质的访问，与接入各种媒体有关的问题都放在MAC层，不同LAN使用的介质访问方法不同。

- 最小帧长：规定有效帧从DA~FCS，最短64字节，最长1518字节
- 争用期：发送数据开始后的时间 2τ
- 最小包长：72字节，8先导+14头+46字节+4CRC
  - 数据不足46字节时，要填充至46字节
  - 帧长<72字节的帧是冲突碎片
- 最小包间隔：9.6us

计算机通过**通信适配器**与外界局域网连接。

适配器的ROM上有计算机硬件地址MAC地址。

每个适配器有一个全球唯一的 `48` 位二进制地址，前24位代表厂家，后24位由厂家指定。

**MAC地址**（Media Access Control Address），称为局域网地址（LAN Address），以太网地址（Ethernet Address）或物理地址（Physical Address），6字节，它是一个用来确认网络设备位置的位址。

`IEEE 802.11` 是无线局域网的通用标准

一个以太网是一个广播域，通过 `VLAN`，可以把较大的局域网分割成地理位置无关的逻辑上的 VLAN，每个 VLAN 是一个广播域。


|                 | 广域网                     | 局域网             |
| --------------- | -------------------------- | ------------------ |
| OSI参考模型层次 | 物理层、数据链路层、网络层 | 物理层、数据链路层 |
| 着重点          | 强调资源共享               | 强调数据传输       |

## 3.8 交换机

- 网桥：根据MAC帧的目的地址对帧进行转发和过滤。
  - 【连接冲突域】
  - 【可互连不同物理层、不同MAC子层和不同速率的以太网】
  - 作用：
    - 过滤信息量
    - 扩大物理范围，增加整个局域网的最大站数
    - 使用不同的物理层
    - 互连不同类型的局域网
    - 提高可靠性
- 交换机：多接口网桥
  - 具有自学习能力，学习的是交换表的内容，交换表中存储着MAC地址到端口的映射。

---------------------

**物理层设备：**

- 中继器
  - 对信号进行再生和还原，放大衰减信号。
  - 两端的网络部分是网段、不是子网。适用于完全相同的两类网络的互连，且两个网段的速率相同。
  - 在物理层上实现局域网网段互连，用于扩展局域网网段的长度
- 集线器（多口中继器，Hub）
  - 不具备定向传送能力，是一个共享式设备。

----------------------

**网段**：一般指一个计算机网络中使用同一物理层设备（传输介质，中继器，集线器等）能够直接通讯的部分。

**冲突域**：在同一个冲突域中，每个节点都能收到所有被发送的帧。
**广播域**：网络中能接收任一设备发出的广播帧的所有设备的集合。

.

|                              | 隔离冲突域 | 隔离广播域 |
| ---------------------------- | ---------- | ---------- |
| 物理层设备（中继器，集线器） | ×          | ×          |
| 链路层设备（网桥，交换机）   | √          | ×          |
| 网络层设备（路由器）         | √          | √          |


## 3.9 题型分析

差错控制、流量控制、介质访问控制，课后习题有些东西啊