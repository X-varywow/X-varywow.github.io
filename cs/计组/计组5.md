考纲内容：
- CPU的功能和基本结构
- 指令执行流程
- 数据通路的功能和基本结构
- 控制器的功能和工作原理
- 异常和中断机制
  - 异常和中断的基本概念、分类、检测和响应
- 指令流水线
  - 指令流水线的基本概念；指令流水线的基本实现
  - 结构冒险、数据冒险和控制冒险的处理；超标量和动态流水线的基本概念
- 多处理器基本概念
  - SISD、SIMD、MIMD、向量处理器的基本概念；硬件多线程的基本概念
  - 多核处理器的基本概念；共享内存多处理器的基本概念


## 5.1 CPU 的基本结构和功能

### 5.1.1 CPU 的基本结构

- **运算器**（对数据进行数据加工）
  - 算术逻辑单元 ALU
  - 暂存寄存器
    - 暂存从主存读来的数据不能放在通用寄存器中，对用户透明
  - 累加器 ACC
    - 用于存放操作数，或运算结果
  - 乘商寄存器 MQ
    - 为了用硬件线路完成乘除指令运算，能自行左右移位的专用寄存器
  - 通用寄存器组，AX,BX,SP等
  - 程序状态字寄存器 PSW
  - 移位器
  - 计数器
- **控制器**（负责协调并控制计算机各部件执行程序的指令序列）
  - 程序计数器 PC
    - 存放下一条指令地址，自动加一
  - 指令寄存器 IR
    - 保存当前正在执行的指令
  - 指令译码器
    - 仅对操作码字段进行译码，提供特定的操作信号
  - 存储器地址寄存器 MAR
  - 存储器数据寄存器 MDR
  - 时序系统
  - 微操作信号发生器

>对用户透明的寄存器：（MAR、MDR、IR）<br>
对用户可见的寄存器：（通用寄存器、程序状态字寄存器）

### 5.1.2 CPU 的功能

- 指令控制
- 操作控制
- 时间控制
- 数据加工
- 中断处理


## 5.2 指令执行

<img src="https://img-1301102143.cos.ap-beijing.myqcloud.com/20220806204245.png">

## 5.3 数据通路

数据通路：数据在功能部件之间传送的路径，包括部件。

## 5.4 控制器实现

>向整机每个部件（包括控制器部件本身）提供协同运行所需的控制信号。

- 微程序的控制器
- 硬布线的控制器（组合逻辑控制器）
  - 特点：指令执行的速度快，指令功能的修改和扩展难

!> 微程序控制器主要由 **微控存**，**微指令寄存器** 和 **地址转移逻辑** 三大部分组成。

- 微指令
  - **编码方式**
    - 直接编码方式（指令字长过长，每位代表一个微命令）
    - 字段直接编码
      - 互斥性微命令分在同一段内
      - 每个段留出全0表示不操作
      - 通过译码电路再发出微命令，比较慢
  - **格式**
    - 水平型
      - 一条水平型微指令定义并执行几种并行的基本操作
      - 微程序短，微指令长
    - 垂直型
      - 一条水平型微指令定义并执行一种并行的基本操作
      - 微程序长，微指令短

## 5.5 异常与中断

- **异常**（CPU内部产生的意外事件）
  - 硬故障中断，存储器校验错、总线错误等
  - 程序性异常，溢出、断点、除0、地址越界、缺页等
- **中断**
  - 来自CPU外部、与CPU执行指令无关
  - CPU 每执行完一条指令就检查中断请求信号线，如果检测到中断请求，就进入中断响应周期

?>响应过程？<br>
关中断 -> 保存断点和程序状态 -> 识别异常和中断并转到相应的处理程序

?>关于自陷trap<br>
自陷是人为预先设定的一种特定处理事件，可由访管指令或自陷指令执行，发生后CPU将进入内核态。

?>影响当前指令执行的处理程序，需要回到当前指令重新执行。如“缺页”，而外部中断是在指令执行完后才检测并处理的，并不影响当前指令的执行

?>Cache完全由硬件实现，不涉及中断。


## 5.6 流水线技术

>把一个重复的过程分解为若干个子过程，每个子过程与其它子过程并行进行。


### 5.6.1 “相关”问题

在流水线中，会遇到一些情况使得指令序列中下一条或几条指令无法按设计的时钟周期执行，并降低流水线运行性能。

- 结构相关
  - 指令重叠执行的过程中，因硬件资源不足而产生冲突
- 数据相关
  - 指令重叠执行的过程中，遇到了后续指令需要用到前面指令的结果，但不能提供的冲突
- 控制相关
  - 流水线中分支指令或其它需要改写 PC 的指令时，遇到了不能及时确定取哪条指令的冲突

### 5.6.2 指令级并行技术

![](https://img-1301102143.cos.ap-beijing.myqcloud.com/202201090154574.jpg)

![](https://img-1301102143.cos.ap-beijing.myqcloud.com/202201090154764.jpg)

## 5.7 多处理器的基本概念

- 单指令单数据流结构 `SISD`
  - 通常只含一个CPU和一个存储器
  - 各指令序列只能并发，不能在同一时刻并行
  - 可采用流水线技术，此时需要多模块交叉方式组织存储器
- 单指令多数据流结构 `SIMD`
  - 数据流可以并行
  - 不同执行单元执行同一条指令，处理不同的数据
  - 各指令序列只能并发，不能在同一时刻并行
- 多指令单数据流结构 `MISD`
  - 实际不存在
- 多指令多数据流结构 `MIMD`
  - 各指令序列并行执行，分别处理多个不同的数据
  - 分类：
    - 多处理器系统
    - 多计算机系统