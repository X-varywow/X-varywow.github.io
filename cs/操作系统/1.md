考纲内容：
- 操作系统的基本概念
- 操作系统的发展历程
- 程序运行环境
  - CPU运行模式；内核模式和用户模式
  - 中断和异常的处理；系统调用
  - 程序的链接和装入；程序运行时内存映像与地址空间
- 操作系统结构
  - 分层、模块化、宏内核、微内核、外核
- 操作系统引导
- 虚拟机

## 1.1 操作系统

**操作系统** 是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的系统软件。
- 负责管理和协调硬件、软件等计算机资源的工作
  - 处理机管理
  - 存储器管理
  - 文件管理
  - 设备管理
- 为上层的应用程序、用户提供简单易用的服务
  - 命令接口（允许用户直接使用）
    - 联机命令接口=交互式命令接口
    - 脱机命令接口=批处理命令接口
  - 程序接口（由一组 **系统调用** 组成，允许用户通过程序间接使用）
    - GUI 图形接口
- 操作系统是系统软件，而不是硬件

**中间件**：提供系统软件和应用软件之间链接的软件

--------------------

## 1.2 操作系统的特征

- `并发`
  - 【指两个或多个事件在同一事件间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的。】
  - `并行`：同一时刻同时发生。
  - `操作系统的并发性`：计算机系统中同时存在多个运行着的程序。
  - 并发与共享互为存在条件
  - 并发和共享是操作系统的两个最基本的特征
- `共享`
  - 【指系统中的资源可供内存中多个并发执行的进程共同使用】
  - 共享方式：
    - 互斥共享方式
    - 同时共享方式
- `虚拟`
  - 【指把一个物理上的实体变为若干个逻辑上的对应物】
  - 虚拟技术：
    - 空分复用技术（如虚拟存储技术）
    - 时分复用技术（如虚拟处理器）
- `异步`
  - 【指多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行走走停停，速度不可预知】
  - 只有系统拥有并发性，才可能导致异步性。


--------------------

## 1.3 操作系统的发展

- **手工操作阶段**
  - 【人机速度矛盾导致资源利用率极低，用户独占全机】
- **单道批处理系统**
  - 【引入`脱机`输入/输出技术，并监督程序负责控制作业的输入/输出】
- **多道批处理系统**
  - 【允许多个程序同时进入内存并允许它们在 CPU 中交替运行，这些程序共享系统中的各种软硬件资源】
  - 设计特点
    - 多道
    - 宏观上并行
    - 微观上并行，内存中多道程序轮流占有CPU
  - 优点：
    - 资源利用率高
  - 缺点：
    - 缺少交互性
- **分时操作系统**
  - 【计算机以时间片为单位轮流为各个用户/作业服务】
  - 优点：【用户请求可以被及时响应，解决了人机交互问题】
  - 特点： 
    - 同时性，指多个终端用户同时使用一台计算机。（多路性）
    - 交互性，人机对话
    - 独立性，系统的多个用户可以彼此独立地操作，互不干扰
    - 及时性
- **实时操作系统**
  - 优点：【能够优先响应一些紧急任务】
  - 主要特点：
    - 及时性
    - 可靠性

`脱机`：外围控制机+更高速的设备（磁带）
`作用`：缓解设备与CPU速度矛盾，实现预输入、预输出

----------------

## 1.4 操作系统结构


- 分层法
- 模块化
- 从内核架构划分
  - 宏内核（Windows,iOS,Android...）
    - 【将操作系统的主要功能没款作为系统内核，运行在核心态】
    - 优点：高性能
    - 缺点：代码庞大，难以维护
  - 微内核
    - 【只把最基本的功能保留在内核】
    - 优点：方便维护
    - 缺点：需要频繁在核心态和用户态切换，性能低


--------------------

## 1.5 处理器运行模式

- 两种指令：
  - 特权指令
  - 非特权指令
- 两种处理器状态
  - 核心态
  - 用户态（目态）
- 两种程序：
  - 内核程序
  - 应用程序



`内核` 是计算机上配置的底层软件，是操作系统最基本、最核心的部分。

操作系统中，内核常驻内存，其它部分需要时调入

实现操作系统内核功能的那些程序就是内核程序。

- **时钟管理**
- **中断管理**
  - 中断，是多道程序设计的基础
  - 只有一小部分属于内核，负责保护和恢复中断现场的信息
- **原语**
  - 【是一种特殊的程序，其执行具有原子性】
- **对系统资源进行管理**
  - 进程管理
    - 进程状态管理
    - 调度与分派，创建与撤销等
  - 存储器管理
    - 空间分配与回收
    - 内存信息保护程序等
  - 设备管理
    - 缓冲区管理
    - 设备分配与回收等


所以，用户态可以发生的事件：系统调用、外部中断、缺页（中断）


----------------

## 1.6 中断和异常

CPU收到计时部件发出的中断信号，切换为核心态对中断进行处理。

`用户态` -> `核心态` ，中断（硬件中断机制）或异常是唯一途径

`核心态` -> `用户态` ，通过执行一个特权指令


- 内中断（`异常`）
  - 故障
  - 自陷
  - 终止
- 外中断（`中断`）
  - （外设请求、人工干预）

中断程序本身可能是用户程序，但是**进入中断的处理程序一定是 OS 程序**；

**子程序调用只需保存程序断点**，即该指令的下一条指令的地址；中断处理不仅要保存断点PC的内容，还要保存程序状态寄存器PSW的内容

外部中断处理过程，PC值由中断隐指令自动保存，而通用寄存器内容由操作系统保存 

关于 [中断隐指令](https://baike.baidu.com/item/%E4%B8%AD%E6%96%AD%E9%9A%90%E6%8C%87%E4%BB%A4/8396650)

------------------

## 1.7 系统调用

**系统调用**【是操作系统向上层（应用程序）提供的接口，可视为特殊的公共子程序】

系统中各种共享资源都由操作系统统一管理，因此用户程序中，与资源有关的操作，都必须通过系统调用的方式向操作系统提出请求，并由操作系统代替完成。

- 设备管理
- 文件管理
- 进程控制
- 进程通信
- 内存管理

系统调用的过程：
传递系统调用参数执行 `->` 陷入指令执行系统 `->` 调用相应服务程序 `->` 返回用户程序

- 应用程序通过系统调用来请求操作系统的服务
- 系统调用发生在用户态，**对系统调用的处理发生在核心态**
- 执行陷入指令会产生内中断，使处理器从用户态 `->` 核心态

-----------------

## 1.8 操作系统引导

- 激活 CPU
- 硬件自检
- （BIOS）加载启动盘，加载主引导记录 MBR
- 扫描硬盘分区表，加载分区引导记录 PBR
- 加载启动管理器，加载操作系统

MBR：检查分区表是否正确，确定哪个分区为活动分区，并在程序结束时将该分区的启动程序（操作系统引导扇区）调入内存加以执行。

-----------------

## 1.9 虚拟机

虚拟机是一台逻辑计算机，指利用特殊的虚拟化技术，为用户提供抽象的、统一的、模拟的计算环境。

## 1.X 问答

**1. 说明库函数与系统调用的区别：**

库函数是语言或应用程序的一部分，可以运行在用户空间中。而系统调用是操作系统的一部分，是内核为用户提供的程序接口，运行在内核空间中，而且许多库函数都会使用系统带来用来实现功能。未执行系统调用的库函数，其执行效率通常要比系统调用的高。因为使用系统调用的过程中，需要上下文的切换及状态的切换。

