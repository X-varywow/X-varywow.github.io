<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="jupyter.css">
    <title>IR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

    <!-- Load mathjax -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: { 
                    automatic: true 
                    }
                },
                "HTML-CSS": {
                    linebreaks: { 
                    automatic: true 
                    }
                }
            });
        
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration -->
</head>

<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">

    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="Txt2Word">Txt2Word<a class="anchor-link" href="#Txt2Word">&#182;</a></h3>
            <p>corpus.txt --&gt; Word2ID.txt</p>
            <p><img src="https://img-1301102143.cos.ap-beijing.myqcloud.com/202201071744276.jpg" style="zoom:60%"></img>
                <img src="https://img-1301102143.cos.ap-beijing.myqcloud.com/202201071745573.jpg"
                    style="zoom:60%"></img>
            </p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[14]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">In</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;corpus.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Word2ID.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">StopPOS</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;m&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

<span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">In</span><span class="p">:</span>
    <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">Sent</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Sent</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">ID</span><span class="o">=</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Item</span><span class="o">=</span><span class="n">Sent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Item</span><span class="p">)):</span>
        <span class="n">Ret</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="n">Item</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Ret</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">SplitItem</span><span class="o">=</span><span class="n">Item</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">Word</span><span class="o">=</span><span class="n">SplitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">POS</span><span class="o">=</span><span class="n">SplitItem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">StopPOS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">POS</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Word</span><span class="p">,</span><span class="n">ID</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="n">Out</span><span class="p">)</span>   <span class="c1">#将 词以及所在句子的ID 写入到 word2id.txt</span>
        
<span class="n">In</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">Out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[16]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Word2ID.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Word2IDSorted.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="wordlist">wordlist<a class="anchor-link" href="#wordlist">&#182;</a></h3>
            <p>读取 Word2IDSorted.txt</p>
            <p>生成 Wordlist.txt</p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[17]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">In</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Word2IDSorted.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Wordlist.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

<span class="n">Prev</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Num</span><span class="o">=</span><span class="mi">0</span>
<span class="n">WordList</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">In</span><span class="p">:</span>
    <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">Item</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">continue</span>
    
    <span class="k">if</span> <span class="n">Line</span> <span class="o">!=</span> <span class="n">Prev</span><span class="p">:</span>
        <span class="n">WordList</span><span class="p">[</span><span class="n">Item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1">#计数器 +1，统计词</span>
        <span class="k">if</span> <span class="n">Num</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">Item</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>  <span class="c1"># 将 num 更新为 大值</span>
            <span class="n">Num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Prev</span><span class="o">=</span><span class="n">Line</span>
<span class="n">In</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">for</span> <span class="n">Word</span> <span class="ow">in</span> <span class="n">WordList</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">Val</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Num</span><span class="o">/</span><span class="n">WordList</span><span class="p">[</span><span class="n">Word</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Word</span><span class="p">,</span><span class="n">Val</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="n">Out</span><span class="p">)</span>
<span class="n">Out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="train">train<a class="anchor-link" href="#train">&#182;</a></h3>
            <p>wordlist.txt --&gt; WordInf --&gt; WordInfo.dat</p>
            <p>Word2IDSorted.txt --&gt; Word2Doc.dat</p>
            <p>corpus.txt --&gt; DocInfo.dat, Doc2Word.dat</p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[18]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">In</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;wordlist.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">WordInf</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">In</span><span class="p">:</span>
    <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">Sent</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Sent</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">WordInf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">WordInf</span><span class="p">[</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">WordInf</span><span class="p">[</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">WordInf</span><span class="p">[</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">WordInf</span><span class="p">[</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">Sent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">In</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">In</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Word2IDSorted.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Word2Doc.dat&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">PrevWord</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">PrevLine</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">No</span><span class="o">=</span><span class="mi">0</span>
<span class="n">DocID</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x10000</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">In</span><span class="p">:</span>
    <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">Item</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Item</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">PrevLine</span> <span class="o">!=</span> <span class="n">Line</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PrevWord</span> <span class="o">!=</span> <span class="n">Item</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">No</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">WordInf</span><span class="p">[</span><span class="n">PrevWord</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Out</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">Id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">No</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">DocID</span><span class="p">[</span><span class="n">Id</span><span class="p">],</span><span class="n">file</span><span class="o">=</span><span class="n">Out</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">Out</span><span class="p">)</span>
            <span class="n">No</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">PrevWord</span> <span class="o">=</span> <span class="n">Item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">No</span><span class="o">&lt;</span><span class="mh">0x10000</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">DocID</span><span class="p">[</span><span class="n">No</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">Item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">No</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">PrevLine</span> <span class="o">=</span> <span class="n">Line</span>
<span class="n">In</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">Out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">Out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;WordInfo.dat&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Word</span> <span class="ow">in</span> <span class="n">WordInf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Word</span><span class="p">,</span><span class="n">WordInf</span><span class="p">[</span><span class="n">Word</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">WordInf</span><span class="p">[</span><span class="n">Word</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">file</span><span class="o">=</span><span class="n">Out</span><span class="p">)</span>
<span class="n">Out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">In</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;corpus.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">DocInfo</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;DocInfo.dat&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">Doc2Word</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Doc2Word.dat&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">In</span><span class="p">:</span>
    <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">Sent</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Doc2Word</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span><span class="n">file</span><span class="o">=</span><span class="n">DocInfo</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Sent</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">ID</span><span class="o">=</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Item</span><span class="o">=</span><span class="n">Sent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">Val</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">Num</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Item</span><span class="p">)):</span>
        <span class="n">Ret</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="n">Item</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Ret</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">SplitItem</span><span class="o">=</span><span class="n">Item</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">WordInf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SplitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">Val</span><span class="o">+=</span><span class="n">WordInf</span><span class="p">[</span><span class="n">SplitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">WordInf</span><span class="p">[</span><span class="n">SplitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Num</span><span class="o">+=</span><span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">SplitItem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">file</span><span class="o">=</span><span class="n">Doc2Word</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Num</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>            
        <span class="n">Val</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Val</span><span class="o">/</span><span class="n">Num</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Val</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="n">Doc2Word</span><span class="p">)</span>
            
<span class="n">In</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">Doc2Word</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">DocInfo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="jp-Cell-inputWrapper">
        <div class="jp-InputPrompt jp-InputArea-prompt">
        </div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <h3 id="search">search<a class="anchor-link" href="#search">&#182;</a></h3>
            <p>需要：WordInfo.dat，DocInfo.dat，Word2Doc.dat，Doc2Word.dat</p>

        </div>
    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span><span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">jieba</span>

<span class="n">g_WordInf</span><span class="o">=</span><span class="p">{}</span>
<span class="n">g_DocInf</span><span class="o">=</span><span class="p">[]</span>


<span class="k">def</span> <span class="nf">WordInit</span><span class="p">(</span><span class="n">wordInfo</span><span class="p">):</span>
    <span class="n">In</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">wordInfo</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">In</span><span class="p">:</span>
        <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">Sent</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Sent</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g_WordInf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">g_WordInf</span><span class="p">[</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">g_WordInf</span><span class="p">[</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Sent</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">g_WordInf</span><span class="p">[</span><span class="n">Sent</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Sent</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">In</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">DocInit</span><span class="p">(</span><span class="n">DocInfo</span><span class="p">):</span>
    <span class="n">In</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">DocInfo</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">In</span><span class="p">:</span>
        <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">g_DocInf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Line</span><span class="p">))</span>
    <span class="n">In</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">Search</span><span class="p">(</span><span class="n">Query</span><span class="p">,</span><span class="n">Word2DocHandle</span><span class="p">,</span><span class="n">Doc2WordHandle</span><span class="p">):</span>
    
    <span class="n">Words</span> <span class="o">=</span> <span class="n">jieba</span><span class="o">.</span><span class="n">lcut</span><span class="p">(</span><span class="n">Query</span><span class="p">)</span>  <span class="c1">#中文分词后的结果</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;分词后：&quot;</span><span class="p">,</span> <span class="n">Words</span><span class="p">)</span>
    
    <span class="n">Candidate</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">Word</span> <span class="ow">in</span> <span class="n">Words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">g_WordInf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Word</span><span class="p">):</span>
            <span class="n">Word2DocHandle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">g_WordInf</span><span class="p">[</span><span class="n">Word</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">Line</span><span class="o">=</span><span class="n">Word2DocHandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">Items</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">Doc</span> <span class="ow">in</span> <span class="n">Items</span><span class="p">:</span>
                <span class="n">Candidate</span><span class="p">[</span><span class="n">Doc</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
<span class="c1">#     DocVal(Candidate,Doc2WordHandle)</span>
    <span class="n">Ret</span> <span class="o">=</span> <span class="n">SortDoc</span><span class="p">(</span><span class="n">Words</span><span class="p">,</span> <span class="n">Candidate</span><span class="p">,</span><span class="n">Doc2WordHandle</span><span class="p">)</span>
    
    
    
    <span class="k">return</span> <span class="n">Ret</span>
            
<span class="c1"># 根据 key, handle 查询句子</span>
<span class="k">def</span> <span class="nf">DocVal</span><span class="p">(</span><span class="n">Doc</span><span class="p">,</span> <span class="n">Doc2WordHandle</span><span class="p">):</span>
        <span class="c1">#print(Doc)</span>
        <span class="c1">#print(g_DocInf[int(Doc)-1])</span>
    <span class="n">Doc2WordHandle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">g_DocInf</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Doc</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">Line</span><span class="o">=</span><span class="n">Doc2WordHandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">Line</span><span class="o">=</span><span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Line</span>
<span class="c1">#         for Word in Line.split(&quot; &quot;):</span>
<span class="c1">#             print(Word)</span>


<span class="c1"># TextRank，句子相似性计算</span>
<span class="k">def</span> <span class="nf">two_sentences_similarity</span><span class="p">(</span><span class="n">sents_1</span><span class="p">,</span> <span class="n">sents_2</span><span class="p">):</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">sents_1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">sents_2</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">sents_similarity</span><span class="o">=</span><span class="n">counter</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sents_1</span><span class="p">))</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sents_2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">sents_similarity</span>

<span class="c1"># 排序返回 res</span>
<span class="k">def</span> <span class="nf">SortDoc</span><span class="p">(</span><span class="n">Words</span><span class="p">,</span> <span class="n">Candidate</span><span class="p">,</span><span class="n">Doc2WordHandle</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">Doc</span> <span class="ow">in</span> <span class="n">Candidate</span><span class="p">:</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">two_sentences_similarity</span><span class="p">(</span><span class="n">Words</span><span class="p">,</span> <span class="n">DocVal</span><span class="p">(</span><span class="n">Doc</span><span class="p">,</span><span class="n">Doc2WordHandle</span><span class="p">))</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rank</span><span class="p">,</span> <span class="n">Doc</span><span class="p">))</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">DocVal</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Doc2WordHandle</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_printRes</span><span class="p">(</span><span class="n">Ret</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;相似度排序后：&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Ret</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    

<span class="k">def</span> <span class="nf">Main</span><span class="p">():</span>
    <span class="n">WordInit</span><span class="p">(</span><span class="s2">&quot;WordInfo.dat&quot;</span><span class="p">)</span> <span class="c1"># 词 9.418601730776034 54865860</span>
    <span class="n">DocInit</span><span class="p">(</span><span class="s2">&quot;DocInfo.dat&quot;</span><span class="p">)</span> <span class="c1"># 一个累加</span>
    <span class="n">Word2DocHandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Word2Doc.dat&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>  <span class="c1">#词所在句子</span>
    <span class="n">Doc2WordHandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Doc2Word.dat&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>  <span class="c1"># 句子及一个度</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Query</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Query:&quot;</span><span class="p">)</span>
        <span class="n">Ret</span><span class="o">=</span><span class="n">Search</span><span class="p">(</span><span class="n">Query</span><span class="p">,</span><span class="n">Word2DocHandle</span><span class="p">,</span><span class="n">Doc2WordHandle</span><span class="p">)</span>
        <span class="n">_printRes</span><span class="p">(</span><span class="n">Ret</span><span class="p">)</span>
        
    <span class="n">Word2DocHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">Doc2WordHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">Main</span><span class="p">()</span>
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="jp-Cell-outputWrapper">


            <div class="jp-OutputArea jp-Cell-outputArea">

                <div class="jp-OutputArea-child">


                    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


                    <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
                        <pre>Query:最爱吃番茄
分词后： [&#39;最爱&#39;, &#39;吃&#39;, &#39;番茄&#39;]
相似度排序后：
1 我 拍手 高兴 地 喊 我 最爱 小 鹅 了 5.414719531419414
2 我们 的 小菜 园 丰收 了 紫 亮 的 茄子 坠 弯 了 枝 碧绿 的 黄瓜 吊 满 了 架 细长 的 豆角 火红 的 番茄 冲 你 笑 真是 一派 丰收 景象 6.7988901826309185
3 着 那 正在 消失 的 饭菜 我 雅兴 大发 禁不住 仿 鲁迅 先生 的 故乡 压轴 句 喜 得 一 经典 句 钱 本是 无所谓 有 无所谓 无 的 正如 这 食堂 的 菜 那 原本 不是 菜 吃 的 人 多 了 也 便 成 了 菜 6.4739012164390966
Query:自然语言处理
分词后： [&#39;自然语言&#39;, &#39;处理&#39;]
相似度排序后：
1 到了 医院 您 把 所有 事情 处理 的 妥妥当当 包扎 时 紧紧 抓 着 我 的 手 告诉 我 坚强 不要 怕 6.007866931549448
Query:天气晴朗的一天
分词后： [&#39;天气晴朗&#39;, &#39;的&#39;, &#39;一天&#39;]
相似度排序后：
1 就是 王湾湾 . 朋友 之间 最 普通 的 帮助 她 会 尽 全力 ; 最 容易 被 忽略 的 事 她 会 很 关心 ; 在 个人 都 不 开心 的 时候 她 会 尽力 去 逗 我 开心 . . . . . . . . . . . . 还有 让 我 感动 的 事 . 所以 , 我 想 对 她 说 快乐 是 因为 有 你 在 陪伴 我 . 吾 习 习惯 造就 人 的 一生 , 好 的 习惯 使 人 终身 受益 4.961429434938382
Query:最 容易 被 忽略 的 事 她 会 很 关心
分词后： [&#39;最&#39;, &#39; &#39;, &#39;容易&#39;, &#39; &#39;, &#39;被&#39;, &#39; &#39;, &#39;忽略&#39;, &#39; &#39;, &#39;的&#39;, &#39; &#39;, &#39;事&#39;, &#39; &#39;, &#39;她&#39;, &#39; &#39;, &#39;会&#39;, &#39; &#39;, &#39;很&#39;, &#39; &#39;, &#39;关心&#39;]
相似度排序后：
1 就是 王湾湾 . 朋友 之间 最 普通 的 帮助 她 会 尽 全力 ; 最 容易 被 忽略 的 事 她 会 很 关心 ; 在 个人 都 不 开心 的 时候 她 会 尽力 去 逗 我 开心 . . . . . . . . . . . . 还有 让 我 感动 的 事 . 所以 , 我 想 对 她 说 快乐 是 因为 有 你 在 陪伴 我 . 吾 习 习惯 造就 人 的 一生 , 好 的 习惯 使 人 终身 受益 4.961429434938382
2 他 谁 会 关心 你 的 功课 能否 赶上 5.999637206672528
3 的 那些 日子 竟然 会 成为 我 最 美 的 回忆 5.168786902775878
4 母亲 选择 了 坚持 尽管 我 也 是 她 一生 的 重负 5.242063281911339
5 选择 苦味 迥异 的 内容 不要 将 目光 集中 在 学习 上 要 学会 独 避 蹊径 巧 选 材料 比如 写 自己 受到 家人 过 份 关爱 时 的 苦闷 感 写 自己 品味 咖啡 时 由 苦 而 甜 的 幸福 感 就 很 有 新意 6.31288393603061
6 东 搞搞 西 弄弄 觉得 没什么 好玩 的 我 正想 离开 的 时候 却 被 那 柜子 的 顶端 所 吸引 了 6.826508882974297
7 反过来 想想 如果 好成绩 那么 容易 就 让 我 得到 那 岂非 大失 它 本身 的 意义 也 失去 了 人们 想要 拥有 它 的 欲望 吗 6.207215953715524
</pre>
                    </div>
                </div>

            </div>

        </div>

    </div>
    <div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
        <div class="jp-Cell-inputWrapper">
            <div class="jp-InputArea jp-Cell-inputArea">
                <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
                <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
                    <div class="CodeMirror cm-s-jupyter">
                        <div class=" highlight hl-ipython3">
                            <pre><span></span> 
</pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
</body>

</html>