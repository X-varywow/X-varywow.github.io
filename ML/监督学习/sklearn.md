

```python
pip install scikit-learn
```


</br>

## _BallTree_


BallTree 算法是一种 **用于多维空间数据** 的非参数空间划分和搜索算法。它属于决策树家族，但与决策树用于分类和回归问题不同，BallTree 主要用于快速检索最近邻点。BallTree 算法在数据挖掘、机器学习、模式识别等领域有广泛应用，尤其是在处理大规模高维数据集时。

</br>

**BallTree 算法的核心概念：**
- 空间划分：BallTree 通过递归地将空间划分为多个区域来构建树结构。每个区域由一个“球体”（或称为“超球体”）来表示，球体的中心是该区域的质心，半径是该区域内所有点到质心的最大距离。
- 树结构：BallTree 是一种二叉树，每个节点代表一个球体，并且包含两个子节点，分别代表左半球和右半球。树的构建过程是递归的，每次选择一个轴将当前球体分割为两个子球体。
- 搜索过程：在搜索最近邻点时，BallTree 从根节点开始，根据目标点与当前球体的位置关系（是否在球体内、外或边界上）决定搜索方向。这个过程是递归的，直到达到叶节点或满足搜索条件为止。
- 效率：BallTree 算法在高维空间中搜索最近邻点时，由于其空间划分策略，通常比简单的线性搜索或基于距离的搜索算法（如 k-d 树）更加高效。

</br>

**BallTree 算法的步骤：**
- 初始化：选择一个轴，将数据集划分为两部分，每个部分对应于一个子球体。
- 递归划分：对每个子球体重复上述过程，直到满足停止条件（如达到最大深度或子球体内的点数少于某个阈值）。
- 构建树：在递归划分的过程中，构建出 BallTree 的树结构。
- 搜索：在需要找到最近邻点时，从根节点开始，根据目标点与当前球体的位置关系，递归地搜索左子树或右子树。

</br>

**BallTree 算法的应用：**
- 最近邻搜索：在高维空间中快速找到与给定点最近的点。
- 聚类：作为聚类算法（如 DBSCAN）的一部分，用于快速发现密度区域。
- 异常检测：通过识别与其它点距离较远的点来检测异常值。

</br>

- **优点：**
  - 在高维空间中搜索效率较高。
  - 可以处理非均匀分布的数据。
- **缺点：**
  - 构建树的时间可能较长，尤其是在数据集很大时。
  - 对于某些类型的数据，可能不如 k-d 树等其他空间划分算法高效。
  - BallTree 算法是一种强大的工具，适用于需要在多维空间中进行高效搜索的场景。然而，选择哪种算法通常取决于具体问题的性质和数据集的特点。



```python
from sklearn.neighbors import BallTree

def get_cloest(X, value):
    # if value in X:
    #     return value
    tree = BallTree([(x, 0) for x in X], leaf_size=2)
    dist, indices = tree.query([(value, 0)], k=2)
    recent_max_value = max([X[i] for i in indices.reshape(1, -1).tolist()[0]])
    return recent_max_value
```

耗时情况：

对于一维数据的查找，（48748 len, cost 34.5ms）（18572 len, cost 13.3ms）;

排序+二分的耗时是其 1/10



----------

参考资料：
- kimi 